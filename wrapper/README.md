# jar包装器-Go 打包器代码

该目录为Go实现`jar`转`exe`的打包模板代码，通过修改配置文件之后，即可实现把你的`jar`文件和该Go源代码一起进行编译得到一个单独的`exe`文件。

通常使用构建器进行构建即可，请参阅主要文档：[传送门](../README.md)

本文档主要讲解如何通过该打包器代码手动构建`exe`程序。

## 1，安装Go开发环境

要想编译这个源代码，安装Go开发环境是必须的，在[官网](https://go.dev/)下载Go安装包进行安装即可，安装完成后，确保`go`命令可以正常使用。

## 2，修改配置文件

当前目录下的`config.yml`即为配置文件，其中有着非常详细的注释，可以根据其中注释提示进行修改，不过简单情况下，保持默认即可。若`config.yaml`不存在则手动创建一个，内容如下：

```yaml
# 配置文件

# 运行配置
run:
  # Java的运行路径，默认安装了Java运行环境的电脑直接填"java"即可，便携式jre需要在此指定，若指定为便携jre，则必须是相对路径，相对于生成的exe可执行文件的路径
  # 例如指定为"java"时，那么程序会使用该命令执行jar文件：java -jar path/to/xxx.jar
  # 如果指定为便携的jre，例如"jre/bin"，那么程序会使用该命令执行jar文件：jre/bin/java -jar path/to/xxx.jar
  java-path: "java"
  # 没有检测到Java运行环境时的提示内容
  error-message: "未能找到可用的Java运行环境（jre）！请先安装Java 8运行环境！"
  # 前置运行参数，即双击exe后自动加上的命令行参数，这个参数会先于命令行运行exe时加上的参数，该配置项为字符串数组类型
  pre-parameters:
# 日志相关
log:
  # 是否把程序的标准输出和标准错误重定向到本地文件，建议控制台应用程序不要开启此项
  write-to-file: false
  # 日志文件输出路径，为相对路径，为相对于可执行文件的位置，若上面变量write-to-file为false，则此配置项无效
  path: "error.log"
# 构建器自动生成和修改的选项，请勿手动修改！
build:
  # 是否为窗体应用程序
  win-app: false
  # 是否使用内嵌的JRE
  # 若开启此项，run.java-path将无效
  use-embed-jre: false
```

## 3，将要转换的`jar`文件放进来

把你要转换成`exe`的`jar`文件重命名为`main.exe`，然后放到当前目录下即可。

## 4，内嵌JRE

如果你要内嵌JRE到`exe`中，则需要将JRE目录复制到当前目录下，并将目录命名为`jre`，然后修改配置文件中`build.use-embed-jre`为`true`。

如果你不需要内嵌JRE，就在当前目录下创建一个名为`jre`的文件夹，并在该文件夹中创建任意文件，作为一个占位，防止编译出错。

## 5，执行编译

通过cmd或者其它命令行终端使用`cd`命令进入到当前目录下，使用`go build`命令即可进行编译。

如果你的`jar`程序是一个**命令行程序**，那么通过下列命令编译：

```bash
go build -ldflags "-w -s" -o "输出exe位置"
```

如果你的`jar`程序是一个**GUI窗体程序**，那么需要修改配置文件中`build.win-app`为`true`，然后通过下列命令编译：

```bash
go build -ldflags "-H=windowsgui -w -s" -o "输出exe位置"
```

编译完成，就得到了一个可以直接运行的`exe`文件了！你的`jar`文件就已经包含在这个`exe`里面了！

## 6，自定义`exe`文件图标

如果需要自定义图标，请参考该文章：[传送门](https://juejin.cn/post/7281118263966351372)

需要在编译步骤之前完成图标资源编译。
